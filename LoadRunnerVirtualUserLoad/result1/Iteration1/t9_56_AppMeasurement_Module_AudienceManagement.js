// For license information, see `https://assets.adobedtm.com/extensions/EPb3826f174b534354aaa5a9e9f1dab55d/AppMeasurement_Module_AudienceManagement.js`.
function AppMeasurement_Module_AudienceManagement(e){var t=this;t.s=e;var n=window;n.s_c_in||(n.s_c_il=[],n.s_c_in=0),t._il=n.s_c_il,t._in=n.s_c_in,t._il[t._in]=t,n.s_c_in++,t._c="s_m",t.setup=function(e){n.DIL&&e&&(e.disableDefaultRequest=!0,e.disableScriptAttachment=!0,e.disableCORS=!0,e.secureDataCollection=!1,t.instance=n.DIL.create(e),t.tools=n.DIL.tools)},t.isReady=function(){return!!t.instance},t.getEventCallConfigParams=function(){return t.instance&&t.instance.api&&t.instance.api.getEventCallConfigParams?t.instance.api.getEventCallConfigParams():{}},t.passData=function(e){t.instance&&t.instance.api&&t.instance.api.passData&&t.instance.api.passData(e)}}"function"!=typeof window.DIL&&(window.DIL=function(a,e){var c,t,h,l,f,n,o,p,i,d,s,r,g,u,m,I,y,_,S,C,b=[];if(a!==Object(a)&&(a={}),h=a.partner,l=a.containerNSID,f=!!a.disableDestinationPublishingIframe,n=a.iframeAkamaiHTTPS,o=a.mappings,p=a.uuidCookie,i=!0===a.enableErrorReporting,d=a.visitorService,s=a.declaredId,r=!0===a.delayAllUntilWindowLoad,g=!0===a.disableIDSyncs,u="undefined"==typeof a.secureDataCollection||!0===a.secureDataCollection,m="boolean"==typeof a.isCoopSafe?a.isCoopSafe:null,I=!0===a.disableDefaultRequest,y=a.afterResultForDefaultRequest,_=a.dpIframeSrc,S=a.visitorConstructor,C=!0===a.disableCORS,i&&DIL.errorModule.activate(),i=!0===window._dil_unit_tests,(c=e)&&b.push(c+""),!h||"string"!=typeof h)return c="DIL partner is invalid or not specified in initConfig",DIL.errorModule.handleError({name:"error",message:c,filename:"dil.js"}),Error(c);if(c="DIL containerNSID is invalid or not specified in initConfig, setting to default of 0",(l||"number"==typeof l)&&(l=parseInt(l,10),!isNaN(l)&&0<=l&&(c="")),c&&(l=0,b.push(c),c=""),(t=DIL.getDil(h,l))instanceof DIL&&t.api.getPartner()===h&&t.api.getContainerNSID()===l)return t;if(!(this instanceof DIL))return new DIL(a,"DIL was not instantiated with the 'new' operator, returning a valid instance with partner = "+h+" and containerNSID = "+l);DIL.registerDil(this,h,l);var O={IS_HTTPS:u||"https:"===document.location.protocol,MILLIS_PER_DAY:864e5,DIL_COOKIE_NAME:"AAMC_"+encodeURIComponent(h)+"_"+l,FIRST_PARTY_SYNCS:"AMSYNCS",FIRST_PARTY_SYNCS_ON_PAGE:"AMSYNCSOP",REGION:"REGION",SIX_MONTHS_IN_MINUTES:259200,IE_VERSION:function(){if(document.documentMode)return document.documentMode;for(var e=7;4<e;e--){var t=document.createElement("div");if(t.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->",t.getElementsByTagName("span").length)return e}return null}()};O.IS_IE_LESS_THAN_10="number"==typeof O.IE_VERSION&&O.IE_VERSION<10;var D,R,v={stuffed:{}},P={},E={firingQueue:[],fired:[],firing:!1,sent:[],errored:[],reservedKeys:{sids:!0,pdata:!0,logdata:!0,callback:!0,postCallbackFn:!0,useImageRequest:!0},firstRequestHasFired:!1,abortRequests:!1,num_of_cors_responses:0,num_of_cors_errors:0,corsErrorSources:[],num_of_img_responses:0,num_of_img_errors:0,platformParams:{d_nsid:l+"",d_rtbd:"json",d_jsonv:DIL.jsonVersion+"",d_dst:"1"},nonModStatsParams:{d_rtbd:!0,d_dst:!0,d_cts:!0,d_rs:!0},modStatsParams:null,adms:{TIME_TO_CATCH_ALL_REQUESTS_RELEASE:2e3,calledBack:!1,mid:null,noVisitorAPI:!1,VisitorAPI:null,instance:null,releaseType:"no VisitorAPI",isOptedOut:!0,isOptedOutCallbackCalled:!1,admsProcessingStarted:!1,process:function(e){try{if(!this.admsProcessingStarted){this.admsProcessingStarted=!0;var t,n,i,s,r=this;if("function"==typeof e&&"function"==typeof e.getInstance){if(d!==Object(d)||!(t=d.namespace)||"string"!=typeof t)return this.releaseType="no namespace",void this.releaseRequests();if((n=e.getInstance(t,{idSyncContainerID:l}))===Object(n)&&n instanceof e&&"function"==typeof n.isAllowed&&"function"==typeof n.getMarketingCloudVisitorID&&"function"==typeof n.getCustomerIDs&&"function"==typeof n.isOptedOut)return this.VisitorAPI=e,n.isAllowed()?(this.instance=n,i=function(e){"VisitorAPI"!==r.releaseType&&(r.mid=e,r.releaseType="VisitorAPI",r.releaseRequests())},"string"==typeof(s=n.getMarketingCloudVisitorID(i))&&s.length?void i(s):void setTimeout(function(){"VisitorAPI"!==r.releaseType&&(r.releaseType="timeout",r.releaseRequests())},this.getLoadTimeout())):(this.releaseType="VisitorAPI not allowed",void this.releaseRequests());this.releaseType="invalid instance"}else this.noVisitorAPI=!0;this.releaseRequests()}}catch(a){this.releaseRequests()}},releaseRequests:function(){this.calledBack=!0,E.registerRequest()},getMarketingCloudVisitorID:function(){return this.instance?this.instance.getMarketingCloudVisitorID():null},getMIDQueryString:function(){var e=w.isPopulatedString,t=this.getMarketingCloudVisitorID();return e(this.mid)&&this.mid===t||(this.mid=t),e(this.mid)?"d_mid="+this.mid+"&":""},getCustomerIDs:function(){return this.instance?this.instance.getCustomerIDs():null},getCustomerIDsQueryString:function(e){if(e!==Object(e))return"";var t,n,i="",s=[],r=[];for(t in e)e.hasOwnProperty(t)&&((n=e[r[0]=t])===Object(n)&&(r[1]=n.id||"",r[2]=n.authState||0,s.push(r),r=[]));if(r=s.length)for(e=0;e<r;e++)i+="&d_cid_ic="+M.encodeAndBuildRequest(s[e],"%01");return i},getIsOptedOut:function(){this.instance?this.instance.isOptedOut([this,this.isOptedOutCallback],this.VisitorAPI.OptOut.GLOBAL,!0):(this.isOptedOut=!1,this.isOptedOutCallbackCalled=!0)},isOptedOutCallback:function(e){this.isOptedOut=e,this.isOptedOutCallbackCalled=!0,E.registerRequest()},getLoadTimeout:function(){var e=this.instance;if(e){if("function"==typeof e.getLoadTimeout)return e.getLoadTimeout();if("undefined"!=typeof e.loadTimeout)return e.loadTimeout}return this.TIME_TO_CATCH_ALL_REQUESTS_RELEASE}},declaredId:{declaredId:{init:null,request:null},declaredIdCombos:{},setDeclaredId:function(e,t){var n=w.isPopulatedString,i=encodeURIComponent;if(e===Object(e)&&n(t)){var s=e.dpid,r=e.dpuuid,a=null;if(n(s)&&n(r))return a=i(s)+"$"+i(r),!0===this.declaredIdCombos[a]?"setDeclaredId: combo exists for type '"+t+"'":(this.declaredIdCombos[a]=!0,this.declaredId[t]={dpid:s,dpuuid:r},"setDeclaredId: succeeded for type '"+t+"'")}return"setDeclaredId: failed for type '"+t+"'"},getDeclaredIdQueryString:function(){var e=this.declaredId.request,t=this.declaredId.init,n=encodeURIComponent,i="";return null!==e?i="&d_dpid="+n(e.dpid)+"&d_dpuuid="+n(e.dpuuid):null!==t&&(i="&d_dpid="+n(t.dpid)+"&d_dpuuid="+n(t.dpuuid)),i}},registerRequest:function(e){var t=this.firingQueue;e===Object(e)&&t.push(e),this.firing||!t.length||r&&!DIL.windowLoaded||(this.adms.isOptedOutCallbackCalled||this.adms.getIsOptedOut(),this.adms.calledBack&&!this.adms.isOptedOut&&this.adms.isOptedOutCallbackCalled&&(this.adms.isOptedOutCallbackCalled=!1,(e=t.shift()).src=e.src.replace(/demdex.net\/event\?d_nsid=/,"demdex.net/event?"+this.adms.getMIDQueryString()+"d_nsid="),w.isPopulatedString(e.corsPostData)&&(e.corsPostData=e.corsPostData.replace(/^d_nsid=/,this.adms.getMIDQueryString()+"d_nsid=")),A.fireRequest(e),this.firstRequestHasFired||"script"!==e.tag&&"cors"!==e.tag||(this.firstRequestHasFired=!0)))},processVisitorAPI:function(){this.adms.process(S||window.Visitor)},getCoopQueryString:function(){var e="";return!0===m?e="&d_coop_safe=1":!1===m&&(e="&d_coop_unsafe=1"),e}},L={MAX_SYNCS_LENGTH:649,id:"destination_publishing_iframe_"+h+"_"+l,url:(u=function(){var e="http://fast.",t="?d_nsid="+l+"#"+encodeURIComponent(document.location.href);return"string"==typeof _&&_.length?_+t:(O.IS_HTTPS&&(e=!0===n?"https://fast.":"https://"),e+h+".demdex.net/dest5.html"+t)})(),onPagePixels:[],iframeHost:null,getIframeHost:function(e){if("string"==typeof e){var t=e.split("/");return 3<=t.length?t[0]+"//"+t[2]:(b.push("getIframeHost: url is malformed: "+e),e)}},iframe:null,iframeHasLoaded:!1,sendingMessages:!1,messages:[],messagesPosted:[],messagesReceived:[],ibsDeleted:[],jsonForComparison:[],jsonDuplicates:[],jsonWaiting:[],jsonProcessed:[],canSetThirdPartyCookies:!0,receivedThirdPartyCookiesNotification:!1,newIframeCreated:null,iframeIdChanged:!1,originalIframeHasLoadedAlready:null,regionChanged:!1,timesRegionChanged:0,attachIframe:function(){function e(){(i=document.createElement("iframe")).sandbox="allow-scripts allow-same-origin",i.title="Adobe ID Syncing iFrame",i.id=n.id,i.name=n.id+"_name",i.style.cssText="display: none; width: 0; height: 0;",i.src=n.url,n.newIframeCreated=!0,t(),document.body.appendChild(i)}function t(){i.addEventListener("load",function(){i.className="aamIframeLoaded",n.iframeHasLoaded=!0,n.requestToProcess()})}if(!O.IS_IE_LESS_THAN_10){var n=this,i=document.getElementById(this.id);i?"IFRAME"!==i.nodeName?(this.id+="_2",this.iframeIdChanged=!0,e()):(this.newIframeCreated=!1,"aamIframeLoaded"!==i.className?(this.originalIframeHasLoadedAlready=!1,t()):(this.iframeHasLoaded=this.originalIframeHasLoadedAlready=!0,this.iframe=i,this.requestToProcess())):e(),this.iframe=i}},requestToProcess:function(e,t){function n(){r.jsonForComparison.push(e),r.jsonWaiting.push([e,t])}var i,s,r=this;if(i=E.adms.instance,e===Object(e)&&i===Object(i)&&i.idSyncContainerID===l&&(L.ibsDeleted.push(e.ibs),delete e.ibs),e&&!w.isEmptyObject(e))if(i=JSON.stringify(e.ibs||[]),s=JSON.stringify(e.dests||[]),this.jsonForComparison.length){var a,o,d,u=!1;for(a=0,o=this.jsonForComparison.length;a<o;a++)if(d=this.jsonForComparison[a],i===JSON.stringify(d.ibs||[])&&s===JSON.stringify(d.dests||[])){u=!0;break}u?this.jsonDuplicates.push(e):n()}else n();this.receivedThirdPartyCookiesNotification&&this.jsonWaiting.length&&(i=this.jsonWaiting.shift(),!1===this.newIframeCreated&&delete i[0].ibs,this.process(i[0],i[1]),this.requestToProcess()),this.iframeHasLoaded&&this.messages.length&&!this.sendingMessages&&(this.sendingMessages=!0,this.sendMessages())},checkIfRegionChanged:function(e){var t=M.getDilCookieField(O.REGION);null!==t&&"undefined"!=typeof e.dcs_region&&parseInt(t,10)!==e.dcs_region&&(this.regionChanged=!0,this.timesRegionChanged++,M.setDilCookieField(O.FIRST_PARTY_SYNCS_ON_PAGE,""),M.setDilCookieField(O.FIRST_PARTY_SYNCS,"")),"undefined"!=typeof e.dcs_region&&M.setDilCookieField(O.REGION,e.dcs_region)},processSyncOnPage:function(e){var t,n,i;if((t=e.ibs)&&t instanceof Array&&(n=t.length))for(e=0;e<n;e++)(i=t[e]).syncOnPage&&this.checkFirstPartyCookie(i,"","syncOnPage")},process:function(e,t){var n,i,s,r,a,o,d=encodeURIComponent;if(t===Object(t)&&(o=M.encodeAndBuildRequest(["",t.dpid||"",t.dpuuid||""],",")),(n=e.dests)&&n instanceof Array&&(i=n.length))for(s=0;s<i;s++)r=n[s],a=[d("dests"),d(r.id||""),d(r.y||""),d(r.c||"")],this.addMessage(a.join("|"));if((n=e.ibs)&&n instanceof Array&&(i=n.length))for(s=0;s<i;s++)r=n[s],a=[d("ibs"),d(r.id||""),d(r.tag||""),M.encodeAndBuildRequest(r.url||[],","),d(r.ttl||""),"",o,r.fireURLSync?"true":"false"],r.syncOnPage||(this.canSetThirdPartyCookies?this.addMessage(a.join("|")):r.fireURLSync&&this.checkFirstPartyCookie(r,a.join("|")));this.jsonProcessed.push(e)},checkFirstPartyCookie:function(e,t,n){var i=(n="syncOnPage"===n)?O.FIRST_PARTY_SYNCS_ON_PAGE:O.FIRST_PARTY_SYNCS,s=this.getOnPageSyncData(i),r=!1,a=!1,o=Math.ceil((new Date).getTime()/O.MILLIS_PER_DAY);s?(s=s.split("*"),r=(a=this.pruneSyncData(s,e.id,o)).dataPresent,a=a.dataValid,r&&a||this.fireSync(n,e,t,s,i,o)):(s=[],this.fireSync(n,e,t,s,i,o))},getOnPageSyncData:function(e){var t=E.adms.instance;return t&&"function"==typeof t.idSyncGetOnPageSyncInfo?t.idSyncGetOnPageSyncInfo():M.getDilCookieField(e)},pruneSyncData:function(e,t,n){var i,s,r,a=!1,o=!1;if(e instanceof Array)for(s=0;s<e.length;s++)i=e[s],r=parseInt(i.split("-")[1],10),i.match("^"+t+"-")?(a=!0,n<r?o=!0:(e.splice(s,1),s--)):r<=n&&(e.splice(s,1),s--);return{dataPresent:a,dataValid:o}},manageSyncsSize:function(e){if(e.join("*").length>this.MAX_SYNCS_LENGTH)for(e.sort(function(e,t){return parseInt(e.split("-")[1],10)-parseInt(t.split("-")[1],10)});e.join("*").length>this.MAX_SYNCS_LENGTH;)e.shift()},fireSync:function(e,t,n,i,s,r){function a(r,a,o,d){return function(){c.onPagePixels[r]=null;var e,t,n,i,s=[];if(e=c.getOnPageSyncData(o))for(t=0,n=(e=e.split("*")).length;t<n;t++)(i=e[t]).match("^"+a.id+"-")||s.push(i);c.setSyncTrackingData(s,a,o,d)}}var o,d,u,c=this;if(e){if("img"===t.tag)for(e=t.url,n=O.IS_HTTPS?"https:":"http:",i=0,o=e.length;i<o;i++){d=e[i],u=/^\/\//.test(d);var l=new Image;l.addEventListener("load",a(this.onPagePixels.length,t,s,r)),l.src=(u?n:"")+d,this.onPagePixels.push(l)}}else this.addMessage(n),this.setSyncTrackingData(i,t,s,r)},addMessage:function(e){this.messages.push(e)},setSyncTrackingData:function(e,t,n,i){e.push(t.id+"-"+(i+Math.ceil(t.ttl/60/24))),this.manageSyncsSize(e),M.setDilCookieField(n,e.join("*"))},sendMessages:function(){var e="",t=encodeURIComponent;this.regionChanged&&(e=t("---destpub-clear-dextp---"),this.regionChanged=!1),this.messages.length&&(e=e+t("---destpub-combined---")+this.messages.join("%01"),this.postMessage(e),this.messages=[]),this.sendingMessages=!1},postMessage:function(e){DIL.xd.postMessage(e,this.url,this.iframe.contentWindow),this.messagesPosted.push(e)},receiveMessage:function(e){var t=/^---destpub-to-parent---/;"string"==typeof e&&t.test(e)&&("canSetThirdPartyCookies"===(t=e.replace(t,"").split("|"))[0]&&(this.canSetThirdPartyCookies="true"===t[1],this.receivedThirdPartyCookiesNotification=!0,this.requestToProcess()),this.messagesReceived.push(e))}},T={traits:function(e){return w.isValidPdata(e)&&(P.sids instanceof Array||(P.sids=[]),M.extendArray(P.sids,e)),this},pixels:function(e){return w.isValidPdata(e)&&(P.pdata instanceof Array||(P.pdata=[]),M.extendArray(P.pdata,e)),this},logs:function(e){return w.isValidLogdata(e)&&(P.logdata!==Object(P.logdata)&&(P.logdata={}),M.extendObject(P.logdata,e)),this},customQueryParams:function(e){return w.isEmptyObject(e)||M.extendObject(P,e,E.reservedKeys),this},signals:function(e,t){var n,i=e;if(!w.isEmptyObject(i)){if(t&&"string"==typeof t)for(n in i={},e)e.hasOwnProperty(n)&&(i[t+n]=e[n]);M.extendObject(P,i,E.reservedKeys)}return this},declaredId:function(e){return E.declaredId.setDeclaredId(e,"request"),this},result:function(e){return"function"==typeof e&&(P.callback=e),this},afterResult:function(e){return"function"==typeof e&&(P.postCallbackFn=e),this},useImageRequest:function(){return P.useImageRequest=!0,this},clearData:function(){return P={},this},submit:function(){return A.submitRequest(P),P={},this},getPartner:function(){return h},getContainerNSID:function(){return l},getEventLog:function(){return b},getState:function(){var e={},t={};return M.extendObject(e,E,{registerRequest:!0}),M.extendObject(t,L,{attachIframe:!0,requestToProcess:!0,process:!0,sendMessages:!0}),{initConfig:a,pendingRequest:P,otherRequestInfo:e,destinationPublishingInfo:t}},idSync:function(e){if(g)return"Error: id syncs have been disabled";if(e!==Object(e)||"string"!=typeof e.dpid||!e.dpid.length)return"Error: config or config.dpid is empty";if("string"!=typeof e.url||!e.url.length)return"Error: config.url is empty";var t,n=e.url,i=e.minutesToLive,s=encodeURIComponent,r=L;n=n.replace(/^https:/,"").replace(/^http:/,"");if(void 0===i)i=20160;else if(i=parseInt(i,10),isNaN(i)||i<=0)return"Error: config.minutesToLive needs to be a positive number";return t=M.encodeAndBuildRequest(["",e.dpid,e.dpuuid||""],","),e=["ibs",s(e.dpid),"img",s(n),i,"",t],r.addMessage(e.join("|")),E.firstRequestHasFired&&r.requestToProcess(),"Successfully queued"},aamIdSync:function(e){return g?"Error: id syncs have been disabled":e===Object(e)&&"string"==typeof e.dpuuid&&e.dpuuid.length?(e.url="//dpm.demdex.net/ibs:dpid="+e.dpid+"&dpuuid="+e.dpuuid,this.idSync(e)):"Error: config or config.dpuuid is empty"},passData:function(e){return w.isEmptyObject(e)?"Error: json is empty or not an object":(L.ibsDeleted.push(e.ibs),delete e.ibs,A.defaultCallback(e),e)},getPlatformParams:function(){return E.platformParams},getEventCallConfigParams:function(){var e,t=E,n=t.modStatsParams,i=t.platformParams;if(!n){for(e in n={},i)i.hasOwnProperty(e)&&!t.nonModStatsParams[e]&&(n[e.replace(/^d_/,"")]=i[e]);!0===m?n.coop_safe=1:!1===m&&(n.coop_unsafe=1),t.modStatsParams=n}return n},setAsCoopSafe:function(){return m=!0,this},setAsCoopUnsafe:function(){return m=!1,this}},A={corsMetadata:(D="none",R=!0,"undefined"!=typeof XMLHttpRequest&&XMLHttpRequest===Object(XMLHttpRequest)&&("withCredentials"in new XMLHttpRequest?D="XMLHttpRequest":new Function("/*@cc_on return /^10/.test(@_jscript_version) @*/")()?D="XMLHttpRequest":"undefined"!=typeof XDomainRequest&&XDomainRequest===Object(XDomainRequest)&&(R=!1),0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")&&(R=!1)),{corsType:D,corsCookiesEnabled:R}),getCORSInstance:function(){return"none"===this.corsMetadata.corsType?null:new window[this.corsMetadata.corsType]},submitRequest:function(e){return E.registerRequest(A.createQueuedRequest(e)),!0},createQueuedRequest:function(e){var t,n,i,s=e.callback,r="img";if(!w.isEmptyObject(o))for(t in o)o.hasOwnProperty(t)&&(null==(n=o[t])||""===n||!(t in e)||n in e||n in E.reservedKeys||null!=(i=e[t])&&""!==i&&(e[n]=i));return w.isValidPdata(e.sids)||(e.sids=[]),w.isValidPdata(e.pdata)||(e.pdata=[]),w.isValidLogdata(e.logdata)||(e.logdata={}),e.logdataArray=M.convertObjectToKeyValuePairs(e.logdata,"=",!0),e.logdataArray.push("_ts="+(new Date).getTime()),"function"!=typeof s&&(s=this.defaultCallback),t=this.makeRequestSrcData(e),(n=this.getCORSInstance())&&!0!==e.useImageRequest&&(r="cors"),{tag:r,src:t.src,corsSrc:t.corsSrc,callbackFn:s,postCallbackFn:e.postCallbackFn,useImageRequest:!!e.useImageRequest,requestData:e,corsInstance:n,corsPostData:t.corsPostData}},defaultCallback:function(e,t){var n,i,s,r,a,o,d,u,c;if(L.checkIfRegionChanged(e),L.processSyncOnPage(e),(n=e.stuff)&&n instanceof Array&&(i=n.length))for(s=0;s<i;s++)(r=n[s])&&r===Object(r)&&(a=r.cn,o=r.cv,void 0!==(d=r.ttl)&&""!==d||(d=Math.floor(M.getMaxCookieExpiresInMinutes()/60/24)),u=r.dmn||"."+document.domain.replace(/^www\./,""),c=r.type,a&&(o||"number"==typeof o)&&("var"!==c&&(d=parseInt(d,10))&&!isNaN(d)&&M.setCookie(a,o,1440*d,"/",u,!1),v.stuffed[a]=o));n=e.uuid,w.isPopulatedString(n)&&!w.isEmptyObject(p)&&("string"==typeof(i=p.path)&&i.length||(i="/"),s=parseInt(p.days,10),isNaN(s)&&(s=100),M.setCookie(p.name||"aam_did",n,1440*s,i,p.domain||"."+document.domain.replace(/^www\./,""),!0===p.secure)),f||E.abortRequests||L.requestToProcess(e,t)},makeRequestSrcData:function(e){e.sids=w.removeEmptyArrayValues(e.sids||[]),e.pdata=w.removeEmptyArrayValues(e.pdata||[]);var t=E,n=t.platformParams,i=M.encodeAndBuildRequest(e.sids,","),s=M.encodeAndBuildRequest(e.pdata,","),r=(e.logdataArray||[]).join("&");delete e.logdataArray;var a,o,d,u,c=O.IS_HTTPS?"https://":"http://",l=t.declaredId.getDeclaredIdQueryString(),f=t.adms.instance?t.adms.getCustomerIDsQueryString(t.adms.getCustomerIDs()):"",p=[];for(a in e)if(!(a in t.reservedKeys)&&e.hasOwnProperty(a))if(o=e[a],a=encodeURIComponent(a),o instanceof Array)for(d=0,u=o.length;d<u;d++)p.push(a+"="+encodeURIComponent(o[d]));else p.push(a+"="+encodeURIComponent(o));return e=p.length?"&"+p.join("&"):"",t="d_nsid="+n.d_nsid+t.getCoopQueryString()+l+f+(i.length?"&d_sid="+i:"")+(s.length?"&d_px="+s:"")+(r.length?"&d_ld="+encodeURIComponent(r):""),n="&d_rtbd="+n.d_rtbd+"&d_jsonv="+n.d_jsonv+"&d_dst="+n.d_dst,s=i=(c=c+h+".demdex.net/event")+"?"+t+n+e,2048<i.length&&(i=i.substring(0,2048).substring(0,i.lastIndexOf("&"))),{corsSrc:c+"?_ts="+(new Date).getTime(),src:i,originalSrc:s,corsPostData:t+n+e,isDeclaredIdCall:""!==l}},fireRequest:function(e){if("img"===e.tag)this.fireImage(e);else{var t=(t=E.declaredId).declaredId.request||t.declaredId.init||{};this.fireCORS(e,{dpid:t.dpid||"",dpuuid:t.dpuuid||""})}},fireImage:function(t){var e,n,i=E;i.abortRequests||(i.firing=!0,e=new Image(0,0),i.sent.push(t),e.onload=function(){i.firing=!1,i.fired.push(t),i.num_of_img_responses++,i.registerRequest()},n=function(e){c="imgAbortOrErrorHandler received the event of type "+e.type,b.push(c),i.abortRequests=!0,i.firing=!1,i.errored.push(t),i.num_of_img_errors++,i.registerRequest()},e.addEventListener("error",n),e.addEventListener("abort",n),e.src=t.src)},fireCORS:function(s,r){var a=this,o=E,e=this.corsMetadata.corsType,t=s.corsSrc,n=s.corsInstance,i=s.corsPostData,d=s.postCallbackFn,u="function"==typeof d;if(!o.abortRequests&&!C){o.firing=!0;try{n.open("post",t,!0),"XMLHttpRequest"===e&&(n.withCredentials=!0,n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4===this.readyState&&200===this.status)e:{var e;try{if((e=JSON.parse(this.responseText))!==Object(e)){a.handleCORSError(s,r,"Response is not JSON");break e}}catch(n){a.handleCORSError(s,r,"Error parsing response as JSON");break e}g&&(L.ibsDeleted.push(e.ibs),delete e.ibs);try{var t=s.callbackFn;o.firing=!1,o.fired.push(s),o.num_of_cors_responses++,t(e,r),u&&d(e,r)}catch(n){n.message="DIL handleCORSResponse caught error with message "+n.message,c=n.message,b.push(c),n.filename=n.filename||"dil.js",n.partner=h,DIL.errorModule.handleError(n);try{t({error:n.name+"|"+n.message},r),u&&d({error:n.name+"|"+n.message},r)}catch(i){}}finally{o.registerRequest()}}}),n.onerror=function(){a.handleCORSError(s,r,"onerror")},n.ontimeout=function(){a.handleCORSError(s,r,"ontimeout")},n.send(i)}catch(O){this.handleCORSError(s,r,"try-catch")}o.sent.push(s),o.declaredId.declaredId.request=null}},handleCORSError:function(e,t,n){E.num_of_cors_errors++,E.corsErrorSources.push(n)},handleRequestError:function(e,t){var n=E;b.push(e),n.abortRequests=!0,n.firing=!1,n.errored.push(t),n.registerRequest()}},w={isValidPdata:function(e){return!!(e instanceof Array&&this.removeEmptyArrayValues(e).length)},isValidLogdata:function(e){return!this.isEmptyObject(e)},isEmptyObject:function(e){if(e!==Object(e))return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},removeEmptyArrayValues:function(e){var t,n=0,i=e.length,s=[];for(n=0;n<i;n++)null!=(t=e[n])&&""!==t&&s.push(t);return s},isPopulatedString:function(e){return"string"==typeof e&&e.length}},M={convertObjectToKeyValuePairs:function(e,t,n){var i,s,r=[];for(i in t||(t="="),e)e.hasOwnProperty(i)&&(null!=(s=e[i])&&""!==s&&r.push(i+t+(n?encodeURIComponent(s):s)));return r},encodeAndBuildRequest:function(e,t){return e.map(function(e){return encodeURIComponent(e)}).join(t)},getCookie:function(e){e+="=";var t,n,i,s=document.cookie.split(";");for(t=0,n=s.length;t<n;t++){for(i=s[t];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(e))return decodeURIComponent(i.substring(e.length,i.length))}return null},setCookie:function(e,t,n,i,s,r){var a=new Date;n&&(n*=6e4),document.cookie=e+"="+encodeURIComponent(t)+(n?";expires="+new Date(a.getTime()+n).toUTCString():"")+(i?";path="+i:"")+(s?";domain="+s:"")+(r?";secure":"")},extendArray:function(e,t){return e instanceof Array&&t instanceof Array&&(Array.prototype.push.apply(e,t),!0)},extendObject:function(e,t,n){var i;if(e!==Object(e)||t!==Object(t))return!1;for(i in t)!t.hasOwnProperty(i)||!w.isEmptyObject(n)&&i in n||(e[i]=t[i]);return!0},getMaxCookieExpiresInMinutes:function(){return O.SIX_MONTHS_IN_MINUTES},getCookieField:function(e,t){var n,i,s=this.getCookie(e),r=decodeURIComponent;if("string"==typeof s)for(n=0,i=(s=s.split("|")).length-1;n<i;n++)if(r(s[n])===t)return r(s[n+1]);return null},getDilCookieField:function(e){return this.getCookieField(O.DIL_COOKIE_NAME,e)},setCookieField:function(e,t,n){var i=this.getCookie(e),s=!1;if(t=(a=encodeURIComponent)(t),n=a(n),"string"==typeof i){var r,a=0;for(r=(i=i.split("|")).length-1;a<r;a++)if(i[a]===t){i[a+1]=n,s=!0;break}s||(i[a=i.length]=t,i[a+1]=n)}else i=[t,n];this.setCookie(e,i.join("|"),this.getMaxCookieExpiresInMinutes(),"/",this.getDomain(),!1)},setDilCookieField:function(e,t){return this.setCookieField(O.DIL_COOKIE_NAME,e,t)},getDomain:function(e){if(!e&&window.location&&(e=window.location.hostname),e)if(/^[0-9.]+$/.test(e))e="";else{var t=e.split("."),n=t.length-1,i=n-1;if(1<n&&t[n].length<=2&&(2===t[n-1].length||",DOMAIN_2_CHAR_EXCEPTIONS,".indexOf(","+t[n]+",")<0)&&i--,0<i)for(e="";i<=n;)e=t[n]+(e?".":"")+e,n--}return e},replaceMethodsWithFunction:function(e,t){var n;if(e===Object(e)&&"function"==typeof t)for(n in e)e.hasOwnProperty(n)&&"function"==typeof e[n]&&(e[n]=t)}};"error"===h&&0===l&&window.addEventListener("load",function(){DIL.windowLoaded=!0});var q=!1,j=function(){q||(q=!0,E.registerRequest(),k(),f||E.abortRequests||L.attachIframe())},k=function(){f||setTimeout(function(){I||E.firstRequestHasFired||("function"==typeof y?T.afterResult(y).submit():T.submit())},DIL.constants.TIME_TO_DEFAULT_REQUEST)};if(t=document,"error"!==h&&(DIL.windowLoaded?j():"complete"!==t.readyState&&"loaded"!==t.readyState?window.addEventListener("load",function(){DIL.windowLoaded=!0,j()}):(DIL.windowLoaded=!0,j())),"error"!==h)try{DIL.xd.receiveMessage(function(e){L.receiveMessage(e.data)},L.getIframeHost(L.url))}catch(N){}E.declaredId.setDeclaredId(s,"init"),E.processVisitorAPI(),O.IS_IE_LESS_THAN_10&&M.replaceMethodsWithFunction(T,function(){return this}),this.api=T,this.getStuffedVariable=function(e){var t=v.stuffed[e];return t||"number"==typeof t||(t=M.getCookie(e))||"number"==typeof t||(t=""),t},this.validators=w,this.helpers=M,this.constants=O,this.log=b,i&&(this.pendingRequest=P,this.requestController=E,this.setDestinationPublishingUrl=u,this.destinationPublishing=L,this.requestProcs=A,this.variables=v,this.callWindowLoadFunctions=j)},DIL.extendStaticPropertiesAndMethods=function(e){var t;if(e===Object(e))for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},DIL.extendStaticPropertiesAndMethods({version:"7.0",jsonVersion:1,constants:{TIME_TO_DEFAULT_REQUEST:50},variables:{scriptNodeList:document.getElementsByTagName("script")},windowLoaded:!1,dils:{},isAddedPostWindowLoad:function(e){this.windowLoaded="function"==typeof e?!!e():"boolean"!=typeof e||e},create:function(e){try{return new DIL(e)}catch(t){throw Error("Error in attempt to create DIL instance with DIL.create(): "+t.message)}},registerDil:function(e,t,n){(t=t+"$"+n)in this.dils||(this.dils[t]=e)},getDil:function(e,t){var n;return"string"!=typeof e&&(e=""),t||(t=0),(n=e+"$"+t)in this.dils?this.dils[n]:Error("The DIL instance with partner = "+e+" and containerNSID = "+t+" was not found")},dexGetQSVars:function(e,t,n){return(t=this.getDil(t,n))instanceof this?t.getStuffedVariable(e):""},xd:{postMessage:function(e,t,n){t&&n.postMessage(e,t.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))},receiveMessage:function(t,n){var e;try{t&&(e=function(e){if("string"==typeof n&&e.origin!==n||"[object Function]"===Object.prototype.toString.call(n)&&!1===n(e.origin))return!1;t(e)}),window[t?"addEventListener":"removeEventListener"]("message",e,!1)}catch(i){}}}}),DIL.errorModule=function(){var i=DIL.create({partner:"error",containerNSID:0,disableDestinationPublishingIframe:!0}),s={harvestererror:14138,destpuberror:14139,dpmerror:14140,generalerror:14137,error:14137,noerrortypedefined:15021,evalerror:15016,rangeerror:15017,referenceerror:15018,typeerror:15019,urierror:15020},r=!1;return{activate:function(){r=!0},handleError:function(e){if(!r)return"DIL error module has not been activated";e!==Object(e)&&(e={});var t=e.name?(e.name+"").toLowerCase():"",n=[];return e={name:t,filename:e.filename?e.filename+"":"",partner:e.partner?e.partner+"":"no_partner",site:e.site?e.site+"":document.location.href,message:e.message?e.message+"":""},n.push(t in s?s[t]:s.noerrortypedefined),i.api.pixels(n).logs(e).useImageRequest().submit(),"DIL error report sent"},pixelMap:s}}(),DIL.tools={},DIL.modules={helpers:{handleModuleError:function(e,t,n){var i="";return t=t||"Error caught in DIL module/submodule: ",e===Object(e)?i=t+(e.message||"err has no message"):(i=t+"err is not a valid object",e={}),e.message=i,n instanceof DIL&&(e.partner=n.api.getPartner()),DIL.errorModule.handleError(e),this.errorMessage=i}}});